import React from 'react'
import { rest } from 'msw'
import { setupServer } from 'msw/node'
import { render, fireEvent, waitFor, screen } from '@testing-library/react'
import '@testing-library/jest-dom/extend-expect'
import Store from '../store/Store'

const server = setupServer(
    rest.get("http://localhost:8000/account", (req, res, ctx) => {
        return res(ctx.json([{ "symbol": "BTCUSDT", "positionAmt": "-0.008", "entryPrice": "33628.26000", "markPrice": "33838.89586842", "unRealizedProfit": "-1.68508694", "liquidationPrice": "40170.09807520", "leverage": "5", "maxNotionalValue": "50000000", "marginType": "isolated", "isolatedMargin": "51.93506080", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "53.62014774", "updateTime": 1625587200445, "marginPositionAmt": "0.008", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "ETHUSDT", "positionAmt": "-0.083", "entryPrice": "2350.90000", "markPrice": "2308.99480891", "unRealizedProfit": "3.47813086", "liquidationPrice": "5733.27838123", "leverage": "5", "maxNotionalValue": "5000000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 1625424033669, "marginPositionAmt": "0.083", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "DOGEUSDT", "positionAmt": "0", "entryPrice": "0.000000", "markPrice": "0.23119000", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "5", "maxNotionalValue": "500000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 1625510373166, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "XRPUSDT", "positionAmt": "0.0", "entryPrice": "0.00000", "markPrice": "0.00000000", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "20", "maxNotionalValue": "250000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 0, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "ADAUSDT", "positionAmt": "0", "entryPrice": "0.00000", "markPrice": "0.00000000", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "20", "maxNotionalValue": "250000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 0, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "DOTUSDT", "positionAmt": "0.0", "entryPrice": "0.0000", "markPrice": "15.64000000", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "7", "maxNotionalValue": "1000000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 1625424085359, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "MATICUSDT", "positionAmt": "0", "entryPrice": "0.00000", "markPrice": "1.11506596", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "5", "maxNotionalValue": "500000", "marginType": "isolated", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 1624152176240, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "EOSUSDT", "positionAmt": "0.0", "entryPrice": "0.0000", "markPrice": "0.00000000", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "20", "maxNotionalValue": "250000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 0, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }, { "symbol": "LINKUSDT", "positionAmt": "0.00", "entryPrice": "0.00000", "markPrice": "0.00000000", "unRealizedProfit": "0.00000000", "liquidationPrice": "0", "leverage": "20", "maxNotionalValue": "250000", "marginType": "cross", "isolatedMargin": "0.00000000", "isAutoAddMargin": "false", "positionSide": "BOTH", "notional": 0, "isolatedWallet": "0", "updateTime": 0, "marginPositionAmt": "0", "marginEntryPrice": 0, "marginNotional": 0, "margin": 0 }]))
    })
)

beforeAll(() => server.listen())
afterEach(() => server.resetHandlers())
afterAll(() => server.close())

test('loads store', async () => {
    render(<Store />)
})
